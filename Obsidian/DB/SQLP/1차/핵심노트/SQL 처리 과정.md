**SQL 언어의 특징**

- SQL은 ‘Structured Query Language’의 줄임말이다. 말 그대로 구조적 질의 언어다.
- 오라클 PL/SQL, SQL Server T-SQL처럼 절차적 프로그래밍 기능을 구현 할 수 있는 확장 언어도 제공하지만, SQL은 기본적으로 구조적(Structured), 집합적(Set-Based), 선언적(declarative)인 질의 언어다.

**SQL 처리 과정**

- SQL을 실행하기 전 최적화 과정을 세분화하면 아래와 같다.
- SQL 파싱 : 사용자로부터 SQL을 전달 받으면 가장 먼저 SQL 파서(Parser)가 파싱을 진행한다.
    - SQL 파싱을 요약하면 아래와 같다.
    - 파싱 트리 생성 : SQL 문을 이루는 개별 구성 요소를 분석해서 파싱 트리 생성.
    - Syntax 체크 : 문법적 오류가 없는지 확인. 예를 들어, 사용 할 수 없는 키워드를 사용했거나 순서가 바르지 않거나 누락된 키워드가 있는지 확인.
    - Semantic 체크 : 의미상 오류가 없는지 확인. 예를 들어, 존재하지 않는 테이블 또는 컬럼을 사용했는지, 사용한 오브젝트에 대한 권한이 있는지 확인.
- SQL 최적화 : 그다음 단계가 SQL 최적화이고, 옵티마이저(Optimizer)가 그 역할을 맡는다. SQL 옵티마이저는 미리 수집한 시스템 및 오브젝트 통계 정보를 바탕으로 다양한 실행 경로를 생성해서 비교한 후 가장 효율적인 하나를 선택한다. 데이터베이스 성능을 결정하는 가장 핵심적인 엔진이다.
    - SQL 옵티마이저는 사용자가 원하는 작업을 가장 효율적으로 수행 할 수 있는 최적의 데이터 액세스 경로를 선택해주는 DBMS의 핵심엔진이다.
    - 옵티마이저의 최적화 단계를 요약하면 다음과 같다.
    - 사용자로부터 전달받은 쿼리를 수행하는데 후보군이 될만한 실행계획들을 도출한다.
    - 데이터 딕셔너리(Data Dictionary)에 미리 수집해 둔 오브젝트 통계 및 시스템 통계정보를 이용해 각 실행 계획의 예상비용을 산정한다.
    - 최저 비용을 나타내는 실행계획을 선택한다.
- 로우 소스 생성기 : SQL 옵티마이저가 선택한 실행 경로를 실제 실행 가능한 코드 또는 프로시저 형태로 포맷팅하는 단계다.

**옵티마이저 힌트**

- 옵티마이저 힌트는 명령어(directives)이므로 특별한 이유가 없는 한 그대로 실행된다.
    - 힌트가 무시되는 이유는 다음과 같다.
    - 문법적으로 맞지 않게 힌트를 기술.
    - 잘못된 참조 사용 : 없는 테이블이나 별칭(Alias)을 사용한 경우, 없는 인덱스명을 지정한 겅우등.
    - 논리적으로 불가능한 액세스 경로
        - 조인절에 등치(=) 조건이 하나도 없는데 해시 조인으로 유도
        - 테이블 전체 건수를 COUNT하는 쿼리에 NULL을 허용하는 단일 컬럼으로 생성한 인덱스를 사용하도록 힌트를 지정
    - 의미적으로 맞지 않게 힌트를 기술 : 예를 들어, 서브쿼리에 unnest와 push_subq를 같이 기술 한 경우
    - 옵티마이저에 의해 내부적으로 쿼리가 변환된 경우
    - 버그
- 유의할 점
    - 힌트안에 인자를 나열 할 때는 ‘,’(콤마)를 사용 할 수 있지만, 힌트와 힌트 사이에 사용하면 안 된다.
    - 테이블을 지정할 때 스키마명까지 명시하면 안 된다.
    - FROM 절 테이블명 옆에 ALIAS를 지정했다면, 힌트에도 반드시 ALIAS를 사용해야 한다.
- 자주 쓰는 힌트 목록

| 분류        | 힌트               | 설명                                                    |
| --------- | ---------------- | ----------------------------------------------------- |
| 최적화 목표    | ALL_ROWS         | 전체 처리속도 최적화                                           |
|           | FIRST_ROWS(N)    | 최초 N건 응답속도 최적화                                        |
| 액세스 방식    | FULL             | Table Full Scan으로 유도                                  |
|           | INDEX            | Index Scan으로 유도                                       |
|           | INDEX_DESC       | Index를 역순으로 스캔하도록 유도                                  |
|           | INDEX_FFS        | Index Fast Full Scan으로 유도                             |
|           | INDEX_SS         | Index Skip Scan으로 유도                                  |
| 조인 순서     | ORDERED          | FROM 절에 나열된 순서대로 조인                                   |
|           | LEADING          | LEADING 힌트 괄호에 기술한 순서대로 조인                            |
|           | SWAP_JOIN_INPUTS | 해시 조인 시, BUILD INPUT을 명시적으로 선택                        |
| 조인 방식     | USE_NL           | NL 조인으로 유도                                            |
|           | USE_MERGE        | 소트 머지 조인으로 유도                                         |
|           | USE_HASH         | 해시 조인으로 유도                                            |
|           | NL_SJ            | NL 세미조인으로 유도                                          |
|           | MERGE_SJ         | 소트머지 세미조인으로 유도                                        |
|           | HASH_SJ          | 해시 세미조인으로 유도                                          |
| 서브 쿼리 팩토링 | MATERIALIZE      | WITH 문으로 정의한 집합을 물리적으로 생성하도록 유도                       |
|           | INLINE           | WITH 문으로 정의한 집합을 물리적으로 생성하지 않고 INLINE 처리하도록 유도        |
| 쿼리 변환     | MERGE            | 뷰 머징 유도                                               |
|           | NO_MERGE         | 뷰 머징 방지                                               |
|           | UNNEST           | 서브쿼리 Unnesting 유도(서브쿼리 풀어서 조인으로 변환)                   |
|           | NO_UNNEST        | 서브쿼리 Unnesting 방지                                     |
|           | PUSH_PRED        | 조인조건 Pushdown 유도                                      |
|           | NO_PUSH_PRED     | 조인조건 Pushdown 방지                                      |
|           | USE_CONCAT       | OR 또는 IN-List 조건을 OR-Expansion으로 유도                   |
|           | NO_EXPAND        | OR 또는 IN-List 조건에 대한 OR-Expansion 방지                  |
| 병렬 처리     | PARALLEL         | 테이블 스캔 또는 DML을 병렬 방식으로 처리하도록 유도                       |
|           | PARALLEL_INDEX   | 인덱스 스캔을 병렬 방식으로 처리하도록 유도                              |
|           | PQ_DISTRIBUTE    | 병렬 수행 시 데이터 분배 방식 결정                                  |
| 기타        | APPEND           | Direct-Path Insert로 유도                                |
|           | DRIVING_SITE     | DB Link Remote 쿼리에 대한 최적화 및 실행 주체 지정(Local 또는 Remote) |
|           | PUSH_SUBQ        | 서브쿼리를 가급적 빨리 필터링하도록 유도                                |
|           | NO_PUSH_SUBQ     | 서브쿼리를 가급적 늦게 필터링하도록 유도                                |