**비용기반 옵티마이저**

- 후보군이 될만한 실행계획들을 도출하고, 데이터 딕셔너리에 미리 수집해 둔 통계정보를 이용해 각 실행계획의 예상비용을 산정하고, 그중 가장 낮은 비용의 실행계획 하나를 선택하는 옵티마이저다.
- 데이터양, 컬럼 값의 수, 컬럼 값 분포, 인덱스 높이, 클러스터링 팩터 등이 통계정보로 사용된다.
- 규칙을 갖고 있다.

**규칙기반 옵티마이저**

- 데이터 특성을 나타내는 통계정보를 전혀 활용하지 않고 단순한 규칙에만 의존한다.
- Table Full Scan이 마지막에 있어서 무조건 Index Scan을 한다.
- 대용량 데이터베이스에는 사용할 수 없다.

옵티마이저의 서브 엔진

- Query Transformer : 사용자로부터 전달받은 SQL을 그대로 최적화하지 않고 우선 최적화에 유리한 형태로 변환을 시도한다.
- Estimator : 쿼리 오퍼레이션 각 단계의 선택도, 카디널리티, 비용을 계산하고, 궁극적으로는 실행계획 전체에 대한 총 비용을 계산함.
- Plan Generator : 하나의 쿼리를 수행하는 데 있어, 후보군이 될만한 실행계획을 생성해 낸다.

**옵티마이저가 힌트를 무시하는 경우**

- 문법적으로 힌트를 맞지 않게 기술
- 잘못된 참조 사용
- 논리적으로 불가능한 액세스 경로
- 의미적으로 맞지 않게 힌트를 기술
- 옵티마이저에 의해 내부적으로 쿼리가 변환된 경우
- 버그

**스스로 학습하는 옵티마이저 기능**

- Adaptive Cursor Sharing
- Statistics Feedback(Cardinality Feedback)
- Adaptive Plans

**통계정보**

- 오브젝트 통계
    - 테이블 통계(레코드 수, 블록 수, 평균 행 길이 등)
    - 인덱스 통계(인덱스 높이, 리프 블록 개수, 클로스터링 팩터 등)
    - 컬럼 통계(중복을 제거한 컬럼 값의 수, 최소값, 최대값, Null 값 개수, 히스토그램 등)
- 시스템 통계
    - CPU 속도
    - Single Block I/O 속도
    - Multiblock I/O 속도
    - 평균적인 Multiblock I/O 개수

**옵티마이저 행동에 영향을 미치는 요소**

- 옵티마이징 팩터 : 인덱스, IOT, 클러스터링, 파티셔닝 등 오브젝트 구성
- DBMS 제약 설정 : PK, FK, Check, Not Null 등
- 통계정보
- 옵티마이저 힌트
- 옵티마이저 관련 파라미터

**옵티마이저의 한계**

- 부족한 옵티마이징 팩터 : 인덱스, IOT, 클러스터링, 파티셔닝 등 오브젝트 구성
- 부정확한 통계 : 정보 수집 및 보관 비용 측면의 한계(샘플링 비율, 수집 주기 등)
- 결합 선택도 산정의 어려움
- 바인드 변수 사용시, 히스토그램 사용에 제약 : 균등분포 가정
- 비현실적인 가정과 규칙에 의존
- 최적화 시간에 허용된 시간 제약

**선택도와 카디널리티**

- ‘=’ 조건으로만 검색하는 경우
    - 선택도 = 1 / NDV
    - 카디널리티 = 총 로우 수 / NDV

**컬럼 통계**

- 중복을 제거한 컬럼 값의 수(num_distinct)
- 최소값(low_value)
- 최대값(high_value)
- 밀도(density)
- 평균 컬럼 길이(avg_col_len)
- NULL 값을 가진 레코드 수(num_nulls)

**시스템 통계**

- CPU 속도
- 평균적인 Single Block I/O 속도
- 평균적인 Multiblock I/O 속도
- 평균적이 Multiblock I/O 개수
- I/O 서브시스템의 최대 처리량(Throughput)
- 병렬 Slave의 평균적인 처리량(Throughput)

**I/O 비용 모델 vs CPU 비용 모델**

- I/O 비용 모델 : 예상되는 디스크 I/O Call 횟수
- CPU 비용 모델 : 예상 I/O 시간과 예상 CPU 사용 시간을 Single Block I/O 시간으로 나눈 값

**히스토그램 유형**

- 도수분포(Frequency) : 값별로 빈도수 저장
- 높이균형(Height-Balanced) : 각 버킷의 높이가 동일하도록 데이터 분포 관리
- 상위도수분포(Top-Frequency) : 많은 레코드를 가진 상위 n개 값의 빈도수 저장
- 하이브리드(Hybrid) : 도수분포와 높이균형 히스토그램의 톡성을 결합

**인덱스를 이용한 테이블 액세스 비용**

- 비용 = 브랜치 레벨 + (리프 블록 수 * 유효 인덱스 선택도) + (클러스터링 팩터 * 유효테이블 선택도)