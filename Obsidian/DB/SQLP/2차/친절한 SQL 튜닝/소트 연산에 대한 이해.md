### 소트 수행 과정

소트는 기본적으로 PGA에 할당한 Sort Area에서 이루어 진다.

- 메모리 공간이 Sort Area가 다 차면, 디스크 Temp 테이블스페이스를 활용한다.

**소트의 두 가지 유형**

- 메모리 소트(In-Memory Sort)
    - 전체 데이터의 정렬 작업을 메모리 내에서 완료하는 것을 말하며, Internal Sort라고도 한다.
- 디스크 소트(To-Disk Sort)
    - 할당받은 Sort Area 내에서 정렬을 완료하지 못해 디스크 공간까지 사용하는 경우를 말하며, External Sort라고도 한다.

**디스크 소트 과정**

- PGA에서 소트할 대상을 읽어들인다.
- 일차적으로 Sort Area에서 정렬을 시도한다.
- 양이 많으면 정렬된 중간집합을 Temp 테이블스페이스에 임시 세그먼트를 만들어 저장한다.
    - Temp 영역에 저장해 둔 중간 단계의 집합을 Sort Run이라고 한다.
- 정렬된 최종 집합을 얻기 위해 이를 다시 Merge한다.
    - 각 Sort Run 내에는 이미 정렬이 완료된 상태이므로 Merge 과정은 어렵지 않다.

소트연산은 메모리 집약적(Memory-intensive)일 뿐만 아니라 CPU 집약적(CPU-intensive)이기도 하다. 처리할 데이터량이 많을 때는 디스크 I/O까지 발생하므로 쿼리 성능을 좌우하는 매우 중요한 요소이다.

- 디스크 소트가 발생하는 순간 SQL 수행 성능은 나빠질 수 밖에 없다.
- 많은 서버 리소스를 사용하고 디스크 I/O가 발생하는 것도 문제지만, 부분 범위 처리를 불가능하게 함으로써 OLTP 환경에서 애플리케이션 성능을 저하시키는 주요인이 되기도 한다.

### 소트 오퍼레이션

- Sort Aggregate
    - 전체 로우를 대상으로 집계를 수행할 때 나타난다..
    - 실제로 데이터를 정렬하지는 않는다.
    - Sort Area를 이용한다.
- Sort Order By
    - 데이터를 정렬할 때 나타난다.
- Sort Group By
    - 소팅 알고리즘을 사용해 그룹별 집계를 수행할 때 나타난다.
- Sort Unique
    - 옵티마이저가 서브쿼리를 풀어 일반 조인문으로 변환하는 것을 서브쿼리 Unnesting이라고한다.
    - Unnesting된 서브쿼리가 M쪽 집합이면(1쪽 집합이어도 조인 컬럼에 Unique 인덱스가 없으면), 메인 쿼리와 조인하기 전에 중복레코드부터 제거해야하는 데, 이때 나타난다.
    - 집합 연산자, Distinct 연산자를 사용할 때도 나타난다.
- Sort Join
    - 소트 머지 조인을 수행할 때 나타난다.
- Window Sort
    - 윈도우 함수를 수행할 때 나타난다.